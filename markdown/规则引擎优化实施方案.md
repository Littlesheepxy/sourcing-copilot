# Bossç›´è˜Sourcingæ™ºèƒ½åŠ©æ‰‹ - è§„åˆ™å¼•æ“ç®€åŒ–æ–¹æ¡ˆ

## 1. ç®€åŒ–ç›®æ ‡

åŸºäºFuse.jsçš„æ¨¡ç³Šæœç´¢èƒ½åŠ›ï¼Œå¯¹è§„åˆ™å¼•æ“è¿›è¡Œå…¨é¢ç®€åŒ–ï¼Œå®ç°ï¼š
1. å£è¯­åŒ–çš„è§„åˆ™å®šä¹‰æ–¹å¼
2. ç›´è§‚æ˜“æ‡‚çš„ç”¨æˆ·ç•Œé¢
3. é™ä½ç”¨æˆ·è®¤çŸ¥è´Ÿæ‹…
4. ä¿ç•™æ ¸å¿ƒç­›é€‰åŠŸèƒ½

## 2. æ•°æ®ç»“æ„ç®€åŒ–

### 2.1 ç®€åŒ–è§„åˆ™ç»“æ„

```typescript
// ç®€åŒ–åçš„è§„åˆ™ç±»å‹
export enum SimpleRuleType {
  å²—ä½ = "å²—ä½",
  å…¬å¸ = "å…¬å¸",
  æŠ€èƒ½ = "æŠ€èƒ½", 
  å­¦æ ¡ = "å­¦æ ¡",
  å­¦å† = "å­¦å†"
}

// é‡è¦æ€§çº§åˆ«
export enum ImportanceLevel {
  ä¸é‡è¦ = 25,
  ä¸€èˆ¬ = 50,
  é‡è¦ = 75,
  éå¸¸é‡è¦ = 100
}

// ç®€åŒ–åçš„è§„åˆ™ç»“æ„
export interface SimpleRule {
  id: string;                            // è§„åˆ™å”¯ä¸€æ ‡è¯†
  type: SimpleRuleType;                  // è§„åˆ™ç±»å‹
  keywords: string[];                    // å…³é”®è¯åˆ—è¡¨
  importance: ImportanceLevel;           // é‡è¦æ€§
  mustMatch: boolean;                    // å¿…é¡»æ»¡è¶³
  enabled: boolean;                      // æ˜¯å¦å¯ç”¨
}

// æ•´ä½“è§„åˆ™é…ç½®
export interface SimpleRulesConfig {
  rules: SimpleRule[];                   // è§„åˆ™åˆ—è¡¨
  passScore: number;                     // é€šè¿‡åˆ†æ•°(0-100)
  autoMode: boolean;                     // è‡ªåŠ¨æ¨¡å¼
}

// è¯„ä¼°ç»“æœ
export interface SimpleEvaluationResult {
  candidateId: string;                   // å€™é€‰äººID
  candidateName?: string;                // å€™é€‰äººå§“å
  score: number;                         // æ€»åˆ†(0-100)
  passed: boolean;                       // æ˜¯å¦é€šè¿‡ç­›é€‰
  details: {                             // è¯¦ç»†ç»“æœ
    ruleType: SimpleRuleType;            // è§„åˆ™ç±»å‹
    matched: boolean;                    // æ˜¯å¦åŒ¹é…
    keywords: string[];                  // å…³é”®è¯
    matchedKeywords?: string[];          // åŒ¹é…çš„å…³é”®è¯
    importance: ImportanceLevel;         // é‡è¦æ€§
  }[];
  failedMustMatchRule?: SimpleRuleType;  // æœªé€šè¿‡çš„å¿…é¡»æ¡ä»¶
  action: "greet" | "skip" | "manual";   // å»ºè®®æ“ä½œ
}
```

## 3. è§„åˆ™å¼•æ“ç®€åŒ–

### 3.1 è§„åˆ™è¯„ä¼°é€»è¾‘

```typescript
export class SimpleRulesEngine {
  /**
   * è¯„ä¼°å€™é€‰äºº
   */
  public evaluateCandidate(candidate: CandidateData, config: SimpleRulesConfig): SimpleEvaluationResult {
    // åˆå§‹åŒ–ç»“æœ
    const result: SimpleEvaluationResult = {
      candidateId: candidate.id,
      candidateName: candidate.name,
      score: 0,
      passed: false,
      details: [],
      action: config.autoMode ? "manual" : "manual"
    };

    // å¯ç”¨çš„è§„åˆ™
    const activeRules = config.rules.filter(r => r.enabled);
    
    // æ£€æŸ¥å¿…é¡»åŒ¹é…çš„è§„åˆ™
    const mustMatchRules = activeRules.filter(r => r.mustMatch);
    for (const rule of mustMatchRules) {
      const matched = this.matchRule(candidate, rule);
      result.details.push({
        ruleType: rule.type,
        matched: matched.matched,
        keywords: rule.keywords,
        matchedKeywords: matched.matchedKeywords,
        importance: rule.importance
      });
      
      if (!matched.matched) {
        // å¿…é¡»æ¡ä»¶ä¸æ»¡è¶³
        result.failedMustMatchRule = rule.type;
        result.passed = false;
        result.action = "skip";
        return result;
      }
    }
    
    // è¯„ä¼°ä¸€èˆ¬è§„åˆ™
    let totalScore = 0;
    let totalWeight = 0;
    
    for (const rule of activeRules) {
      if (rule.mustMatch) continue; // å·²ç»è¯„ä¼°è¿‡å¿…é¡»æ¡ä»¶
      
      const importance = rule.importance;
      const matched = this.matchRule(candidate, rule);
      
      result.details.push({
        ruleType: rule.type,
        matched: matched.matched,
        keywords: rule.keywords,
        matchedKeywords: matched.matchedKeywords,
        importance: rule.importance
      });
      
      if (matched.matched) {
        totalScore += importance;
      }
      
      totalWeight += importance;
    }
    
    // è®¡ç®—æœ€ç»ˆå¾—åˆ†
    result.score = totalWeight > 0 ? Math.round((totalScore / totalWeight) * 100) : 0;
    result.passed = result.score >= config.passScore;
    result.action = config.autoMode ? (result.passed ? "greet" : "skip") : "manual";
    
    return result;
  }
  
  /**
   * åŒ¹é…å•æ¡è§„åˆ™
   */
  private matchRule(candidate: CandidateData, rule: SimpleRule): { matched: boolean, matchedKeywords: string[] } {
    let fieldValue: any;
    let matched = false;
    let matchedKeywords: string[] = [];
    
    // æ ¹æ®è§„åˆ™ç±»å‹è·å–ç›¸åº”å­—æ®µå€¼
    switch (rule.type) {
      case SimpleRuleType.å²—ä½:
        fieldValue = candidate.position || '';
        break;
      case SimpleRuleType.å…¬å¸:
        fieldValue = candidate.company || [];
        break;
      case SimpleRuleType.æŠ€èƒ½:
        fieldValue = candidate.skills || [];
        break;
      case SimpleRuleType.å­¦æ ¡:
        fieldValue = candidate.schools || [];
        break;
      case SimpleRuleType.å­¦å†:
        fieldValue = candidate.education || '';
        break;
    }
    
    // ä½¿ç”¨Fuse.jsè¿›è¡Œæ¨¡ç³ŠåŒ¹é…
    if (fieldValue) {
      // å°†å­—æ®µå€¼è½¬ä¸ºæ•°ç»„
      const fieldValues = Array.isArray(fieldValue) ? fieldValue : [fieldValue];
      
      // éå†æ‰€æœ‰å…³é”®è¯
      for (const keyword of rule.keywords) {
        // ä½¿ç”¨Fuse.jsæœç´¢
        const fuse = new Fuse(fieldValues, {
          includeScore: true,
          threshold: 0.4, // åŒ¹é…é˜ˆå€¼
          ignoreLocation: true
        });
        
        const searchResult = fuse.search(keyword);
        
        // æœ‰åŒ¹é…ç»“æœ
        if (searchResult.length > 0) {
          matched = true;
          matchedKeywords.push(keyword);
        }
      }
    }
    
    return { matched, matchedKeywords };
  }
}
```

## 4. UIè®¾è®¡ç®€åŒ–

### 4.1 è§„åˆ™å¡ç‰‡è®¾è®¡

```html
<!-- ç®€åŒ–çš„è§„åˆ™å¡ç‰‡ -->
<div class="rule-card" data-rule-type="å²—ä½">
  <div class="rule-header">
    <div class="rule-icon">ğŸ‘¨â€ğŸ’»</div>
    <div class="rule-title">å²—ä½</div>
    <div class="rule-toggle">
      <label class="switch">
        <input type="checkbox" checked>
        <span class="slider round"></span>
      </label>
    </div>
  </div>
  
  <div class="rule-body">
    <!-- å…³é”®è¯è¾“å…¥ -->
    <div class="keyword-input">
      <input type="text" placeholder="è¾“å…¥å…³é”®è¯ï¼Œå›è½¦æ·»åŠ " class="tag-input">
      <div class="tags-container">
        <!-- å…³é”®è¯æ ‡ç­¾åŒºåŸŸ -->
      </div>
    </div>
    
    <!-- é‡è¦æ€§è®¾ç½® -->
    <div class="importance-slider">
      <span>é‡è¦æ€§ï¼š</span>
      <input type="range" min="1" max="4" value="2" class="range-slider">
      <span class="importance-label">ä¸€èˆ¬</span>
    </div>
    
    <!-- å¿…é¡»æ»¡è¶³å¤é€‰æ¡† -->
    <label class="must-match">
      <input type="checkbox">
      <span>å¿…é¡»æ»¡è¶³æ­¤æ¡ä»¶</span>
    </label>
  </div>
</div>
```

### 4.2 ç®€åŒ–çš„CSSæ ·å¼

```css
/* è§„åˆ™å¡ç‰‡æ ·å¼ */
.rule-card {
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  margin-bottom: 16px;
  overflow: hidden;
  transition: transform 0.2s;
}

.rule-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

/* è§„åˆ™æ ‡é¢˜åŒº */
.rule-header {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  background-color: #f5f7fa;
  border-bottom: 1px solid #e2e8f0;
}

.rule-icon {
  font-size: 20px;
  margin-right: 8px;
}

.rule-title {
  font-weight: 600;
  flex: 1;
}

/* è§„åˆ™å†…å®¹åŒº */
.rule-body {
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* æ ‡ç­¾è¾“å…¥æ¡† */
.keyword-input {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.tag-input {
  padding: 8px 12px;
  border: 1px solid #e2e8f0;
  border-radius: 4px;
}

.tags-container {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.tag {
  display: inline-flex;
  align-items: center;
  background-color: #edf2f7;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 14px;
}

.tag .remove-tag {
  margin-left: 4px;
  background: none;
  border: none;
  cursor: pointer;
  color: #a0aec0;
}

/* é‡è¦æ€§æ»‘å— */
.importance-slider {
  display: flex;
  align-items: center;
  gap: 8px;
}

.range-slider {
  flex: 1;
  height: 4px;
}

.importance-label {
  min-width: 60px;
  text-align: right;
  font-size: 14px;
}

/* è§„åˆ™ç±»å‹é¢œè‰² */
.rule-card[data-rule-type="å²—ä½"] .rule-header {
  border-left: 4px solid #4F46E5;
}

.rule-card[data-rule-type="å…¬å¸"] .rule-header {
  border-left: 4px solid #0EA5E9;
}

.rule-card[data-rule-type="æŠ€èƒ½"] .rule-header {
  border-left: 4px solid #10B981;
}

.rule-card[data-rule-type="å­¦æ ¡"] .rule-header {
  border-left: 4px solid #F59E0B;
}

.rule-card[data-rule-type="å­¦å†"] .rule-header {
  border-left: 4px solid #EC4899;
}
```

### 4.3 ç®€åŒ–çš„JSé€»è¾‘

```javascript
document.addEventListener('DOMContentLoaded', () => {
  // åˆå§‹åŒ–è§„åˆ™ç®¡ç†
  initRuleManager();
});

// è§„åˆ™ç®¡ç†
function initRuleManager() {
  // æ·»åŠ è§„åˆ™æŒ‰é’®
  const addRuleBtn = document.getElementById('add-rule-btn');
  
  // è§„åˆ™ç±»å‹é€‰æ‹©
  addRuleBtn.addEventListener('click', () => {
    showRuleTypeSelector();
  });
  
  // åˆå§‹åŒ–å·²æœ‰è§„åˆ™å¡ç‰‡
  initExistingRules();
}

// æ˜¾ç¤ºè§„åˆ™ç±»å‹é€‰æ‹©å™¨
function showRuleTypeSelector() {
  const ruleTypes = [
    { type: 'å²—ä½', icon: 'ğŸ‘¨â€ğŸ’»' },
    { type: 'å…¬å¸', icon: 'ğŸ¢' },
    { type: 'æŠ€èƒ½', icon: 'ğŸ”§' },
    { type: 'å­¦æ ¡', icon: 'ğŸ“' },
    { type: 'å­¦å†', icon: 'ğŸ“œ' }
  ];
  
  // åˆ›å»ºé€‰æ‹©å™¨UI
  const selector = document.createElement('div');
  selector.className = 'rule-type-selector';
  
  ruleTypes.forEach(({ type, icon }) => {
    const typeOption = document.createElement('div');
    typeOption.className = 'rule-type-option';
    typeOption.innerHTML = `
      <div class="rule-type-icon">${icon}</div>
      <div class="rule-type-name">${type}</div>
    `;
    
    typeOption.addEventListener('click', () => {
      addNewRule(type, icon);
      selector.remove();
    });
    
    selector.appendChild(typeOption);
  });
  
  // æ·»åŠ åˆ°é¡µé¢
  document.body.appendChild(selector);
}

// æ·»åŠ æ–°è§„åˆ™
function addNewRule(type, icon) {
  const ruleId = 'rule_' + Date.now();
  const rulesContainer = document.getElementById('rules-container');
  
  const ruleCard = document.createElement('div');
  ruleCard.className = 'rule-card';
  ruleCard.dataset.ruleId = ruleId;
  ruleCard.dataset.ruleType = type;
  
  ruleCard.innerHTML = `
    <div class="rule-header">
      <div class="rule-icon">${icon}</div>
      <div class="rule-title">${type}</div>
      <div class="rule-toggle">
        <label class="switch">
          <input type="checkbox" checked class="rule-enabled">
          <span class="slider round"></span>
        </label>
      </div>
      <button class="delete-rule-btn">âœ•</button>
    </div>
    
    <div class="rule-body">
      <div class="keyword-input">
        <input type="text" placeholder="è¾“å…¥å…³é”®è¯ï¼Œå›è½¦æ·»åŠ " class="tag-input">
        <div class="tags-container"></div>
      </div>
      
      <div class="importance-slider">
        <span>é‡è¦æ€§ï¼š</span>
        <input type="range" min="1" max="4" value="2" class="range-slider">
        <span class="importance-label">ä¸€èˆ¬</span>
      </div>
      
      <label class="must-match">
        <input type="checkbox" class="must-match-checkbox">
        <span>å¿…é¡»æ»¡è¶³æ­¤æ¡ä»¶</span>
      </label>
    </div>
  `;
  
  // æ·»åŠ åˆ°å®¹å™¨
  rulesContainer.appendChild(ruleCard);
  
  // åˆå§‹åŒ–äº‹ä»¶å¤„ç†
  initRuleCardEvents(ruleCard);
}

// åˆå§‹åŒ–è§„åˆ™å¡ç‰‡äº‹ä»¶
function initRuleCardEvents(ruleCard) {
  // æ ‡ç­¾è¾“å…¥
  const tagInput = ruleCard.querySelector('.tag-input');
  const tagsContainer = ruleCard.querySelector('.tags-container');
  
  tagInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && tagInput.value.trim()) {
      addTag(tagsContainer, tagInput.value.trim());
      tagInput.value = '';
      e.preventDefault();
    }
  });
  
  // é‡è¦æ€§æ»‘å—
  const importanceSlider = ruleCard.querySelector('.range-slider');
  const importanceLabel = ruleCard.querySelector('.importance-label');
  
  importanceSlider.addEventListener('input', () => {
    const labels = ['ä¸é‡è¦', 'ä¸€èˆ¬', 'é‡è¦', 'éå¸¸é‡è¦'];
    importanceLabel.textContent = labels[importanceSlider.value - 1];
  });
  
  // åˆ é™¤è§„åˆ™æŒ‰é’®
  const deleteBtn = ruleCard.querySelector('.delete-rule-btn');
  deleteBtn.addEventListener('click', () => {
    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è§„åˆ™å—ï¼Ÿ')) {
      ruleCard.remove();
    }
  });
}

// æ·»åŠ æ ‡ç­¾
function addTag(container, text) {
  const tag = document.createElement('span');
  tag.className = 'tag';
  tag.innerHTML = `
    ${text}
    <button class="remove-tag">Ã—</button>
  `;
  
  // ç§»é™¤æ ‡ç­¾äº‹ä»¶
  tag.querySelector('.remove-tag').addEventListener('click', () => {
    tag.remove();
  });
  
  container.appendChild(tag);
}

// æ”¶é›†è§„åˆ™æ•°æ®
function collectRulesData() {
  const ruleCards = document.querySelectorAll('.rule-card');
  const rules = [];
  
  ruleCards.forEach(card => {
    // åªæ”¶é›†å¯ç”¨çš„è§„åˆ™
    const enabled = card.querySelector('.rule-enabled').checked;
    if (!enabled) return;
    
    // æ”¶é›†æ ‡ç­¾
    const tags = [];
    card.querySelectorAll('.tag').forEach(tag => {
      tags.push(tag.textContent.trim());
    });
    
    // è·³è¿‡æ²¡æœ‰å…³é”®è¯çš„è§„åˆ™
    if (tags.length === 0) return;
    
    const rule = {
      id: card.dataset.ruleId,
      type: card.dataset.ruleType,
      keywords: tags,
      importance: parseInt(card.querySelector('.range-slider').value) * 25, // è½¬æ¢ä¸ºåˆ†æ•°
      mustMatch: card.querySelector('.must-match-checkbox').checked,
      enabled: true
    };
    
    rules.push(rule);
  });
  
  // å…¨å±€è®¾ç½®
  const passScore = document.getElementById('pass-score').value;
  const autoMode = document.getElementById('auto-mode').checked;
  
  return {
    rules,
    passScore: parseInt(passScore),
    autoMode
  };
}
```

## 5. ç•Œé¢æ”¹è¿›

### 5.1 å…¨å±€è®¾ç½®ç®€åŒ–

```html
<div class="settings-panel">
  <h3>ç­›é€‰è®¾ç½®</h3>
  
  <div class="setting-row">
    <label>é€šè¿‡åˆ†æ•°ï¼š</label>
    <div class="score-slider-container">
      <input type="range" id="pass-score" min="0" max="100" value="60">
      <span id="score-value">60</span>
    </div>
  </div>
  
  <div class="setting-row">
    <label class="checkbox-label">
      <input type="checkbox" id="auto-mode">
      <span>è‡ªåŠ¨æ¨¡å¼ï¼ˆè‡ªåŠ¨æ‰“æ‹›å‘¼/è·³è¿‡ï¼‰</span>
    </label>
  </div>
</div>
```

### 5.2 æµ‹è¯•ç•Œé¢ç®€åŒ–

```html
<div class="test-panel">
  <div class="test-input">
    <h3>æµ‹è¯•æ•°æ®</h3>
    <textarea id="test-data" placeholder="ç²˜è´´å€™é€‰äººJSONæ•°æ®..."></textarea>
    <button id="test-button">æµ‹è¯•è§„åˆ™</button>
  </div>
  
  <div class="test-result">
    <h3>æµ‹è¯•ç»“æœ</h3>
    <div id="result-display">
      <!-- ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
    </div>
  </div>
</div>
```

## 6. å®æ–½æ­¥éª¤

1. åˆ›å»ºæ–°çš„ç®€åŒ–è§„åˆ™å¼•æ“æ–‡ä»¶ `simple-rules-engine.ts`
2. æ›´æ–°è§„åˆ™ç¼–è¾‘å™¨HTMLç»“æ„ï¼Œç®€åŒ–UI
3. é‡å†™CSSæ ·å¼ï¼Œå®ç°æ–°çš„è§†è§‰è®¾è®¡
4. å®ç°æ ‡ç­¾å¼å…³é”®è¯è¾“å…¥ç»„ä»¶
5. æ•´åˆFuse.jsè¿›è¡ŒåŒ¹é…

## 7. ä¼˜ç‚¹æ€»ç»“

1. **æ›´ç®€å•çš„æ•°æ®ç»“æ„**ï¼šä»å¤æ‚çš„åµŒå¥—æ¡ä»¶ç®€åŒ–ä¸ºæ‰å¹³çš„å…³é”®è¯åˆ—è¡¨
2. **å£è¯­åŒ–æ“ä½œ**ï¼šä½¿ç”¨"å²—ä½"ã€"æŠ€èƒ½"ç­‰ç›´è§‚æœ¯è¯­æ›¿ä»£æŠ€æœ¯æœ¯è¯­
3. **é™ä½è®¤çŸ¥è´Ÿæ‹…**ï¼š4æ¡£é‡è¦æ€§æ›¿ä»£0-100æƒé‡ï¼Œç®€åŒ–ç”¨æˆ·å†³ç­–
4. **æ›´å¥½çš„è§†è§‰åé¦ˆ**ï¼šæ ‡ç­¾å’Œé¢œè‰²æä¾›ç›´è§‚çš„è§„åˆ™ç±»å‹åŒºåˆ†
5. **æ¨¡ç³ŠåŒ¹é…èƒ½åŠ›**ï¼šåˆ©ç”¨Fuse.jså®ç°æ™ºèƒ½åŒ¹é…ï¼Œå®¹å¿æ‹¼å†™é”™è¯¯å’Œè¿‘ä¼¼è¡¨è¾¾ 